# reviews
### Задачи
1. Добавление нового отзыва во временную базу (отправка данных в битрикс).
2. Перенос отзыва из временной базы в основную.
3. Добавление нового пользователя (и отправка данных в битрикс).
4. Выдача всех или заданное количество отзывов в формате json.
5. Удаление отзыва пользователем (только отзывы самого пользователя).
6. Удаление отзыва админом (любой отзыв).

----

## API

### Комментарии

Все запросы к api будут иметь следующий вид 
```http
cleanapi.php?name=<function_name>&param_1=param_1_value&param_2=param_2_value...
```
##### Например запрос на получение 3 отзывов 
```http
cleanapi.php?name=get&count=3
```
Т.е при написании скрипта первым шагом будет получение имени функции
```php
$FName = $_GET['name'];
```
И выбор обработчика в соответствии с функцией 
```php
switch ($FName) {
    case "get":
        $RCount = isset($_GET['count']) ? $_GET['count'] : '';
        // isset — Определяет, была ли установлена переменная значением, отличным от NULL

        //тело обработчика
        break;
```
Файл cleanapi.php создавать не нужно, он уже создан и весь код необходимо писать внутри if
```php
<?php
include "config.php";
session_start();
$app_cookie = $_COOKIE['vk_app_6727873'];
if($app_cookie)
{
  
 ...

}
else
{
  echo "PERMISSION DENIED";
}
 ?>

```
Формат записи функций

### functionName

    Входные параметры [name_param_1,name_param_2]
    Выходные данные JSON

отзыв JSON
```php
{
  "reviewid" : id,
  "userid" : userid,
  "istmp": true ,
  "firstname": "Den",
  "lastname": "Asonov",
  "avatar": "https://pp.userapi.com/c834403/v834403193/12e49c/KAfYY0vUrFQ.jpg",
  "vkid": 1234567,
  "okid": 1234567,
  "text": "Review text"
}
```

### список API функций

-----

## addtmpreview
Добавление нового отзыва
    Входные параметры [text,userid]
    Выходные данные JSON отзыва

 -----

## login

Авторизация
Входные параметры []
Выходные данные userid
    
 -----

## reviewtocommon

##### Доступ "Admin"
Перенос отзыва из временной базы в общую
    Входные параметры [idreview,iduser]

    Выходные данные "success" при успешном перемещении : NULL иначе

 -----

## getreview

Получение отзывов
    Входные параметры [count,offset,iduser]
    Выходные данные массив отзывов в формате JSON [...,....,....]
Если параметр "count" пуст то возвращает все отзывы.

Если параметр "offset" пуст то возращаем отзывы с начала списка.

Если у пользователя есть отзывы во временной таблице то необходимо добавить его отзывы к отзывам из основной таблицы.

##### Доступ "Admin"

Если тип пользователя "Admin" то вернуть отзывы из временной таблицы и из основной (сначала отзывы из временной).

все комментарии из временной таблицы должны быть с флагом istmp = true.

 -----

## removereview

Удаление отзыва
    Входные параметры [idreview,iduser]
    Выходные данные "success" при успешном удалении : NULL иначе
Обычный пользователь может удалить только свой комментарий (из временной и из основной таблицы).

##### Доступ "Admin"
Админ может удалить любой комментарий.


------

## Настройка рабочего окружения

Удобнее всего работать в Atom

https://atom.io/download/windows_x64

Для работы с удаленной папкой по ftp устанавливаем плагин "ftp-remote-edit"

Установить плагин можно прямо из Atom: File > settings > install в строку поиска вставляем ftp-remote-edit и устанавливаем первый плагин.

Далее открываем папку с проектом и копируем туда файл конфигурации ".ftpconfig".

Затем жмем Packages > Remote FTP > Toggle. В открывшемся окне жмём connect.

Затем переходим по адресу https://keepinclean.ru/develop/review/ 

вводим логин и пароль и начинаем работать.
